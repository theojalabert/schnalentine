<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Une schemande schnarticuli√®re...</title>

  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --bg1: #e3f2fd;
      --bg2: #77b5fe;
      --card: #ffffffcc;
      --yes: #90d5ff;
      --yesHover: #77b5fe;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      font-family: system-ui, sans-serif;
      overflow: hidden;
      padding: 16px;
      position: relative;
    }

    /* PHOTO BACKGROUND */
    .photo-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }

    .photo {
      position: absolute;
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,.2);
      border: 4px solid white;
      will-change: transform;
    }

    /* FULL-SCREEN CONFETTI CANVAS */
    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }

    .card {
      width: min(520px, 85vw);
      padding: 20px 18px;
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 18px 60px rgba(0,0,0,.15);
      position: relative;
      z-index: 10;
      overflow: visible;
    }

    .art {
      width: min(140px, 75vw);
      margin: -60px auto 8px;
      display: block;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
      position: relative;
      z-index: 15;
    }

    h1 {
      font-size: clamp(22px, 3.5vw, 36px);
      margin: 10px 0 14px;
    }

    .button-zone {
      position: relative;
      width: min(400px, 90%);
      height: 120px;
      margin: 0 auto;
      touch-action: none;
    }

    button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 800;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease;
    }

    #yesBtn {
      left: 18%;
      background: var(--yes);
      color: #fff;
      will-change: transform; /* ‚úÖ MODIF: scale plus fluide */
    }
    #yesBtn:hover { background: var(--yesHover); }

    /* ‚úÖ MODIF: noBtn anim√© via transform translate3d */
    #noBtn {
      left: 0;
      top: 0;
      background: #e5e7eb;
      color: #111827;
      transition: none;
      will-change: transform;
      opacity: 1;
      transition: opacity 120ms ease; /* ‚úÖ MODIF: fade during poof */
    }

    .hint {
      margin-top: 8px;
      font-size: 12px;
      opacity: .7;
    }

    .result {
      display: none;
      margin-top: 14px;
      animation: pop .35s ease;
    }

    .result h2 {
      font-size: clamp(26px, 4vw, 38px);
      margin: 8px 0;
    }

    .fireworks {
      width: min(300px, 85vw);
      margin: 0 auto;
      display: block;
    }

    @keyframes pop {
      from { transform: scale(.96); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* Responsive pour mobile */
    @media (max-width: 768px) {
      .photo {
        width: 120px;
        height: 120px;
      }
      .photo:nth-child(n+13) {
        display: none;
      }
    }

    /* --- Cartoon "poof" smoke (darker + longer) --- */
    .puff {
      position: absolute;
      width: 22px;
      height: 22px;
      pointer-events: none;
      left: 0;
      top: 0;
      border-radius: 50%;
      /* plus fonc√© */
      background: radial-gradient(
        circle,
        rgba(140,140,140,.98) 0%,
        rgba(140,140,140,.55) 45%,
        rgba(140,140,140,0) 78%
      );
      transform: translate(-50%, -50%);
      /* plus long */
      animation: puff 620ms ease-out forwards;
      filter: blur(.4px);
      z-index: 50;
    }

    @keyframes puff {
      from {
        opacity: 1;
        transform: translate(-50%, -50%) translate(0, 0) scale(0.65);
      }
      to {
        opacity: 0;
        /* monte un peu + s‚Äô√©tale plus */
        transform: translate(-50%, -50%) translate(var(--dx), calc(var(--dy) - 10px)) scale(3.0);
      }
    }
  </style>
</head>

<body>
  <!-- PHOTO BACKGROUND -->
  <div class="photo-bg">
    <img class="photo" src="./images/photo1.jpeg" alt="">
    <img class="photo" src="./images/photo2.jpeg" alt="">
    <img class="photo" src="./images/photo3.jpeg" alt="">
    <img class="photo" src="./images/photo4.jpeg" alt="">
    <img class="photo" src="./images/photo5.jpeg" alt="">
    <img class="photo" src="./images/photo6.jpeg" alt="">
    <img class="photo" src="./images/photo7.jpeg" alt="">
    <img class="photo" src="./images/photo8.jpeg" alt="">
    <img class="photo" src="./images/photo9.jpeg" alt="">
    <img class="photo" src="./images/photo10.jpeg" alt="">
    <img class="photo" src="./images/photo11.jpeg" alt="">
    <img class="photo" src="./images/photo12.jpeg" alt="">
    <img class="photo" src="./images/photo13.jpeg" alt="">
    <img class="photo" src="./images/photo14.jpeg" alt="">
    <img class="photo" src="./images/photo15.jpeg" alt="">
    <img class="photo" src="./images/photo16.jpeg" alt="">
    <img class="photo" src="./images/photo17.jpeg" alt="">
    <img class="photo" src="./images/photo18.jpeg" alt="">
    <img class="photo" src="./images/photo19.jpeg" alt="">
    <img class="photo" src="./images/photo20.jpeg" alt="">
    <img class="photo" src="./images/photo21.jpeg" alt="">
    <img class="photo" src="./images/photo22.jpeg" alt="">
  </div>

  <canvas id="confettiCanvas"></canvas>

  <main class="card">
    <img class="art" src="./images/schnappi.png" alt="Schnappi">
    <h1>Schnappi veux-tu √™tre ma Schnalentine ?</h1>

    <section class="button-zone" id="zone">
      <button id="yesBtn">Oui</button>
      <button id="noBtn">Non</button>
    </section>

    <div class="hint" id="hint">Ici, on ne pratique que le ‚ÄúOui‚Äù.<br>Et puis c'est interdit de me dire non.</div>

    <section class="result" id="result">
      <h2>YOUPI ! üéâ</h2>
      <img
        class="fireworks"
        src="./images/croco.gif"
        alt="Feux d'artifice"
      />
    </section>
  </main>

  <script>
    const zone = document.getElementById("zone");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const result = document.getElementById("result");
    const hint = document.getElementById("hint");

    /* ---------- CONFETTI ---------- */
    const confettiCanvas = document.getElementById("confettiCanvas");

    function resizeConfettiCanvas() {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = "100vw";
      confettiCanvas.style.height = "100vh";
    }

    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeConfettiCanvas, 150));

    const confettiInstance = confetti.create(confettiCanvas, {
      resize: false,
      useWorker: true
    });

    function fullScreenConfetti() {
      const end = Date.now() + 1600;

      (function frame() {
        confettiInstance({
          particleCount: 12,
          spread: 90,
          startVelocity: 45,
          ticks: 180,
          origin: { x: Math.random(), y: Math.random() * 0.3 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();

      setTimeout(() => {
        confettiInstance({
          particleCount: 300,
          spread: 140,
          startVelocity: 60,
          ticks: 220,
          origin: { x: 0.5, y: 0.55 }
        });
      }, 300);
    }

    /* ---------- BOUNCING PHOTOS ---------- */
    const photos = document.querySelectorAll('.photo');
    const photoData = [];

    photos.forEach((photo, index) => {
      const rotations = [-15, -12, -8, -5, 5, 8, 10, 12, 15];
      const rotation = rotations[index % rotations.length];

      const data = {
        element: photo,
        x: Math.random() * (window.innerWidth - 180),
        y: Math.random() * (window.innerHeight - 180),
        vx: (Math.random() - 0.5) * 2.5,
        vy: (Math.random() - 0.5) * 2.5,
        rotation: rotation
      };

      photoData.push(data);
      photo.style.transform = `rotate(${rotation}deg)`;
    });

    function animatePhotos() {
      photoData.forEach(data => {
        data.x += data.vx;
        data.y += data.vy;

        if (data.x <= 0 || data.x >= window.innerWidth - 180) {
          data.vx *= -1;
          data.x = Math.max(0, Math.min(data.x, window.innerWidth - 180));
        }
        if (data.y <= 0 || data.y >= window.innerHeight - 180) {
          data.vy *= -1;
          data.y = Math.max(0, Math.min(data.y, window.innerHeight - 180));
        }

        data.element.style.left = data.x + 'px';
        data.element.style.top = data.y + 'px';
      });

      requestAnimationFrame(animatePhotos);
    }

    animatePhotos();

    window.addEventListener('resize', () => {
      photoData.forEach(data => {
        data.x = Math.min(data.x, window.innerWidth - 180);
        data.y = Math.min(data.y, window.innerHeight - 180);
      });
    });

    /* ---------- YES BUTTON (SMOOTH SCALE) ---------- */
    let yesScale = 1;
    let yesTarget = 1;
    let fleeMeter = 0;

    function smoothTo(current, target, dt, smoothness) {
      const k = 1 - Math.exp(-smoothness * dt);
      return current + (target - current) * k;
    }

    /* ---------- NO BUTTON RUNS AWAY (EDGE BOOST + RETURN HOME + POOF) ---------- */
    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    let zRect = zone.getBoundingClientRect();
    let bw = noBtn.offsetWidth;
    let bh = noBtn.offsetHeight;

    // Home
    let x0 = zRect.width * 0.62 - bw / 2;
    let y0 = zRect.height * 0.50 - bh / 2;

    // Current
    let x = x0, y = y0;
    let vx = 0, vy = 0;

    // Mouse
    let mx = x + bw / 2;
    let my = y + bh / 2;
    let mouseInside = false;

    // Feel
    const TRIGGER_R = 150;
    const STRENGTH = 3200;
    const SWIRL = 1400;
    const MAX_SPEED = 1400;
    const RESTIT = 0.72;
    const DAMP_60 = 0.86;

    // New
    const IDLE_MS = 320;
    const RETURN_K = 22;
    const RETURN_DAMP_60 = 0.78;

    const EDGE_MARGIN = 26;
    const EDGE_BOOST = 2.6;
    const EDGE_CENTER_PULL = 2200;

    // Mouse tracking
    let lastMouseMoveT = performance.now();
    let lastMX = mx, lastMY = my;

    // Poof state
    let poofing = false;

    function spawnPuffs(px, py) {
      const count = 7;
      for (let i = 0; i < count; i++) {
        const puff = document.createElement("div");
        puff.className = "puff";
        puff.style.left = px + "px";
        puff.style.top = py + "px";

        const ang = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.4;
        const dist = 16 + Math.random() * 16;
        puff.style.setProperty("--dx", `${Math.cos(ang) * dist}px`);
        puff.style.setProperty("--dy", `${Math.sin(ang) * dist - 6}px`);

        zone.appendChild(puff);
        puff.addEventListener("animationend", () => puff.remove(), { once: true });
      }
    }

    noBtn.style.transform = `translate3d(${x}px, ${y}px, 0)`;

    function refreshZone() {
      zRect = zone.getBoundingClientRect();
      bw = noBtn.offsetWidth;
      bh = noBtn.offsetHeight;

      x0 = clamp(x0, 0, zRect.width - bw);
      y0 = clamp(y0, 0, zRect.height - bh);
      x  = clamp(x,  0, zRect.width - bw);
      y  = clamp(y,  0, zRect.height - bh);

      noBtn.style.transform = `translate3d(${x}px, ${y}px, 0)`;
    }

    window.addEventListener("resize", refreshZone);
    window.addEventListener("orientationchange", () => setTimeout(refreshZone, 150));

    function updateMouse(e) {
      const r = zone.getBoundingClientRect();
      mx = e.clientX - r.left;
      my = e.clientY - r.top;
      mouseInside = true;

      const moved = Math.hypot(mx - lastMX, my - lastMY);
      if (moved > 0.8) {
        lastMouseMoveT = performance.now();
        lastMX = mx;
        lastMY = my;
      }
    }

    zone.addEventListener("pointermove", updateMouse);
    zone.addEventListener("pointerdown", (e) => {
      updateMouse(e);
      lastMouseMoveT = performance.now();
    });
    zone.addEventListener("pointerleave", () => {
      mouseInside = false;
    });

    // Click "Non" => cartoon poof
    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      if (poofing) return;

      poofing = true;

      const cx = x + bw / 2;
      const cy = y + bh / 2;

      spawnPuffs(cx, cy);

      noBtn.style.pointerEvents = "none";
      noBtn.style.opacity = "0";

      setTimeout(() => {
        x = x0;
        y = y0;
        vx = 0;
        vy = 0;
        noBtn.style.transform = `translate3d(${x}px, ${y}px, 0)`;
      }, 220);

      setTimeout(() => {
        noBtn.style.opacity = "1";
        noBtn.style.pointerEvents = "auto";
        poofing = false;
      }, 700);
    });

    let lastT = performance.now();
    function animateNo(t) {
      const dt = Math.min(0.033, (t - lastT) / 1000);
      lastT = t;

      // If poofing, freeze at home and return yes smoothly
      if (poofing) {
        x = x0; y = y0; vx = 0; vy = 0;
        noBtn.style.transform = `translate3d(${x}px, ${y}px, 0)`;

        fleeMeter = smoothTo(fleeMeter, 0, dt, 10);
        yesTarget = 1;
        yesScale = smoothTo(yesScale, yesTarget, dt, 12);
        yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;

        requestAnimationFrame(animateNo);
        return;
      }

      const minX = 0, maxX = zRect.width - bw;
      const minY = 0, maxY = zRect.height - bh;

      const cx = x + bw / 2;
      const cy = y + bh / 2;

      const mouseActive = mouseInside && (t - lastMouseMoveT) < IDLE_MS;

      const distLeft   = x - minX;
      const distRight  = maxX - x;
      const distTop    = y - minY;
      const distBottom = maxY - y;

      const edgeX = clamp(1 - Math.min(distLeft, distRight) / EDGE_MARGIN, 0, 1);
      const edgeY = clamp(1 - Math.min(distTop, distBottom) / EDGE_MARGIN, 0, 1);
      const corner = edgeX * edgeY;

      let fleeInstant = 0;

      if (mouseActive) {
        let dx = cx - mx;
        let dy = cy - my;
        let d = Math.hypot(dx, dy) || 0.0001;

        if (d < TRIGGER_R) {
          const ux = dx / d;
          const uy = dy / d;
          const k = (1 - d / TRIGGER_R);

          const boost = 1 + EDGE_BOOST * corner;

          const ax = ux * STRENGTH * k * boost;
          const ay = uy * STRENGTH * k * boost;

          const tx = -uy;
          const ty =  ux;
          const wobble = 0.6 + 0.4 * Math.sin(t / 140);
          const sx = tx * SWIRL * k * wobble;
          const sy = ty * SWIRL * k * wobble;

          vx += (ax + sx) * dt;
          vy += (ay + sy) * dt;

          if (corner > 0.01) {
            const toCenterX = (maxX * 0.5) - x;
            const toCenterY = (maxY * 0.5) - y;
            const cd = Math.hypot(toCenterX, toCenterY) || 1;
            vx += (toCenterX / cd) * EDGE_CENTER_PULL * corner * dt;
            vy += (toCenterY / cd) * EDGE_CENTER_PULL * corner * dt;
          }

          fleeInstant = clamp(k * (1 + 1.2 * corner), 0, 1);
        }
      } else {
        const rx = x0 - x;
        const ry = y0 - y;

        vx += rx * RETURN_K * dt;
        vy += ry * RETURN_K * dt;

        const rdamp = Math.pow(RETURN_DAMP_60, dt * 60);
        vx *= rdamp;
        vy *= rdamp;

        fleeInstant = 0;
      }

      const damp = Math.pow(DAMP_60, dt * 60);
      vx *= damp;
      vy *= damp;

      const dynMaxSpeed = MAX_SPEED * (1 + 1.3 * corner);
      const speed = Math.hypot(vx, vy);
      if (speed > dynMaxSpeed) {
        vx = (vx / speed) * dynMaxSpeed;
        vy = (vy / speed) * dynMaxSpeed;
      }

      x += vx * dt;
      y += vy * dt;

      if (x < minX) { x = minX; vx = Math.abs(vx) * RESTIT; }
      if (x > maxX) { x = maxX; vx = -Math.abs(vx) * RESTIT; }
      if (y < minY) { y = minY; vy = Math.abs(vy) * RESTIT; }
      if (y > maxY) { y = maxY; vy = -Math.abs(vy) * RESTIT; }

      noBtn.style.transform = `translate3d(${x}px, ${y}px, 0)`;

      fleeMeter = smoothTo(fleeMeter, fleeInstant, dt, 10);
      yesTarget = 1 + fleeMeter * 1.2;
      yesTarget = clamp(yesTarget, 1, 2.2);

      yesScale = smoothTo(yesScale, yesTarget, dt, 12);
      yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;

      requestAnimationFrame(animateNo);
    }

    requestAnimationFrame(animateNo);

    /* ---------- YES CLICK ---------- */
    yesBtn.addEventListener("click", () => {
      zone.style.display = "none";
      hint.style.display = "none";
      result.style.display = "block";
      resizeConfettiCanvas();
      fullScreenConfetti();
    });
  </script>
</body>
</html>